package gov.dol.childlabor;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;

/**
 * Created by tru on 10/28/2015.
 */
public class ExploitationListAdapter extends ArrayAdapter<Country> {
    private LayoutInflater inflater;
    private int sectionNumber;

    public ExploitationListAdapter(Context context, Country[] values, int sectionNumber) {
        super(context, R.layout.country_list_row, values);
        inflater = LayoutInflater.from(context);
        this.sectionNumber = sectionNumber;
    }

    @Override
    public View getView(int position, View convertView, ViewGroup parent) {
        View theView = inflater.inflate(R.layout.exploitation_type_list_row, parent, false);

        Country country = getItem(position);

        TextView countryTextView = (TextView) theView.findViewById(R.id.exploitationListTextView);
        countryTextView.setText(country.getName());
        countryTextView.setTag(country);

        CountryGood[] goods;
        switch(sectionNumber) {
            case 2:
                goods = country.getChildLaborGoods();
                break;
            case 3:
                goods = country.getForcedLaborGoods();
                break;
            case 4:
                goods = country.getForcedChildLaborGoods();
                break;
            default:
                goods = country.getGoods();
        }
        addGoods(theView, goods);

        return theView;
    }

    public void addGoods(View theView, CountryGood[] countryGoods) {
        LinearLayout goodLinearLayout = (LinearLayout) theView.findViewById(R.id.exploitationListGoodLinearLayout);

        for (CountryGood good : countryGoods) {
            View countryGoodWidget = inflater.inflate(R.layout.exploitation_list_good_widget, goodLinearLayout, false);
            countryGoodWidget.setTag(good);

            ImageView countryGoodImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListGoodImageView);
            countryGoodImageView.setImageDrawable(AppHelpers.getGoodDrawable(getContext(), good.getGoodName()));
            String imageDescription = good.getGoodName();

            ImageView exploitationImageView;
            if(good.hasForcedChildLabor()) {
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListForcedChildLaborImageView);
                exploitationImageView.setVisibility(View.VISIBLE);
                imageDescription += ", Forced Child Labor";
            }
            else if(good.hasChildLabor()) {
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListChildLaborImageView);
                exploitationImageView.setVisibility(View.VISIBLE);
                imageDescription += ", Child Labor";
            }
            else {
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListForcedChildLaborImageView);
                exploitationImageView.setVisibility(View.INVISIBLE);
            }

            if(good.hasForcedLabor()) {
                exploitationImageView = (ImageView) countryGoodWidget.findViewById(R.id.exploitationListForcedLaborImageView);
                exploitationImageView.setVisibility(View.VISIBLE);
                imageDescription += ", Forced Labor";
            }

            countryGoodImageView.setContentDescription(imageDescription);
            goodLinearLayout.addView(countryGoodWidget);
        }

    }

}
